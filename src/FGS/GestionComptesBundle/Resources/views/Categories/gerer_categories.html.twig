{% extends "FGSGestionComptesBundle::layout.html.twig" %}

{% block modal %}
<div class="modal" id="confirmation">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal">x</button>
			<h4 class="modal-title">Attention</h4>
			</div>
			<div class="modal-body">
			<p>
				Vous êtes sur le point de supprimer cette Catégorie : <strong id="ma_categorie"></strong> ?
			</p>
			<p>
				Tout les mouvements financiers lié à cette Catégorie seront transféré à la catégorie <strong id="son_parent"></strong>
			</p>
			<p>
				Cette Action ne pourra pas être annulé.
			</p>
			</div>
			<div class="modal-footer">
			<a class="btn btn-danger" id="valider_suppression" href="#">
				<span class="glyphicon glyphicon-trash"></span> 
				Supprimer cette catégorie
			</a>
			<a href="" class="btn btn-info" data-dismiss="modal" >
				Annuler
			</a>
			</div>
		</div>
	</div>
</div>
{% endblock %}

{% macro generer_enfants(enfants) %}
<ul class='media-list' style='margin-top: 20px;'>
	{% for children in enfants %}

	<li class='media''>
		<div class='media-left'>
			<div>
				<span class=' img-circle bg-primary text-center glyphicon {{ children.icone }}'> </span>
			</div>
		</div>
		<div class='media-body' style='width: 10000px;'>
			
			<div style='line-height: 34px; vertical-align: middle;'>
				{{ children.libelle }} 
				<div class='pull-right' >

					<a  href="{{ path('fgs_gestion_comptes_modifier_categorie', {"id":children.id}) }}" class="btn btn-info ">
						<span class="glyphicon glyphicon-pencil"></span><span class='hidden-xs'> Modifier</span>
					</a>
					
					{{ render(controller('FGSGestionComptesBundle:Categories:gerenerLienSuppression', {'cmf': children})) }}
					


					<div class='btn-group'>
						<a  href="{{ loop.first ? '#' : path('fgs_gestion_comptes_monter_categorie', {'id': children.id}) }}" class="btn btn-success{{ loop.first ? ' disabled'}}">
							<span class="glyphicon glyphicon-arrow-up"></span>
						</a>
						<a  href="{{ loop.last ? '#' :path('fgs_gestion_comptes_descendre_categorie', {'id': children.id}) }}" class="btn btn-success{{ loop.last ? ' disabled'}}">
							<span class="glyphicon glyphicon-arrow-down"></span>
						</a>
					</div>
					
				</div>
			</div>

			{{ children.childrens is not empty  ? _self.generer_enfants(children.childrens) }}
			
		</div>
		
	</li>
	{% endfor %}
</ul>
{% endmacro %}


{% block contenu %}
<h1 class="page-header">Gérer mes catégories</h1>

<div class='row'>
	<div class='col-md-offset-1 col-md-10'>
	{% if listeCategories is not empty %}
		{{ _self.generer_enfants(listeCategories) }}
	{% else %}
		<div class="alert alert-warning alert-dismissible fade in" role="alert">
			<p><span class="glyphicon glyphicon-warning-sign"></span> Vous n'avez pas encore de catégories.</p>
		</div>
	{% endif %}
	</div>
</div>
{% endblock %}


{% block stylesheets %}
{{ parent() }}
<link rel="stylesheet" href="{{ asset('bundles/fgsgestioncomptes/css/iconset/daily-life.css') }}">
<style>
.media-left .glyphicon{
	padding: 	10px;
}
.media-left{
padding-right: 0px;
}
.media-left > div, .media-body > div{
	/*border-bottom: 	1px solid #eee;*/
	padding: 		0px 0px 15px 10px;
}
.modal-dialog {
	z-index: 1050;
}
</style>
{% endblock %}




{% block javascripts %}
{{ parent() }}
<script>
$(document).ready(function(){
	$('button[data-categorie]').click(function(e)
	{
		//stop de la propagation de l'évènement
		e.preventDefault();

		//récupération de élément courant
		$this = $(this);

		//modification de la fenêtre de confirmation
		$('#ma_categorie').html($this.attr('data-categorie'));
		$('#son_parent').html($this.attr('data-parent'));
		$('#valider_suppression').attr('href', $this.attr('id'));
		
		//affichage de la fenêtre de confirmation
		$('#confirmation').modal('show');
	});
	$('#valider_suppression').click(function(e){
		
		//stop de la propagation de l'évènement
		e.preventDefault();
		
		//récupération de l'identifiant du bouton sur lequel on avait cliqué  puis click
		formulaire = '#formulaire'+$(this).attr('href');
		$(formulaire).submit();
		
	})
});
</script>
{% endblock %}
