{% extends "FGSGestionComptesBundle::layout.html.twig" %}

{% block title %}Visualisation des données d'un compte{% endblock %}

{% block contenu %}
	<div class='row'>
		<div class="col-md-1 col-xs-2" class="height: 38px;">
			<img src="{{ asset('bundles/fgsgestioncomptes/'~compte.banque.urlImage) }}" style="height: 32px; margin-top: 22px; margin-bottom:12" />
		</div>
		<div class="col-md-11 col-xs-10">
			<h1>{{ compte.nom }} ({{ date|date('M Y') }})</h1>
		</div>
	</div>
	<div class='row'>
		<div class='col-md-4'>
			<div class='info'>
				<div class='col-md-6' style='color:#fff; padding:20px; margin:0px; background-color:#8ac249; color:#fff;'>
					<h3 style='font-size: 1rem; padding:0px; margin:0px;'>Revenu à ce jour</h3>
					<div style='font-size: 2rem; '>{{ totalRevenuNotPlanified }} €</div>
				</div>
				<div class='col-md-6' style='color:#fff; padding:20px; overflow:hidden; margin:0px; background-color:#83b845; color:fff;text-align:right;'>
					<h3 style='font-size: 1rem; padding:0px; margin:0px;'>Revenu à venir</h3>
					<div style='font-size: 2rem; '>{{ totalRevenuPlanified }} €</div>
				</div>
			</div>
		</div>
		
		<div class='col-md-4'>
			<div class='info'>
				<div class='col-md-6' style='color:#fff; padding:20px; margin:0px; background-color:#008cba; color:#fff;'>
					<h3 style='font-size: 1rem; padding:0px; margin:0px;'>Total à ce jour</h3>
					<div style='font-size: 2rem; '>{{ compte.montantActuel }} €</div>
				</div>
				<div class='col-md-6' style='color:#fff; padding:20px; overflow:hidden; margin:0px; background-color:#008cba; color:fff;text-align:right;'>
					<h3 style='font-size: 1rem; padding:0px; margin:0px;'>Total planifié</h3>
					<div style='font-size: 2rem; '>{{ compte.montantActuel + totalRevenuPlanified + totalDepensePlanified }} €</div>
				</div>
			</div>
		</div>
		
		<div class='col-md-4'>
			<div class='info'>
				<div class='col-md-6' style='color:#fff; padding: 20px;margin:0px; background-color:#dc1c5d; color:fff;'>
					<h3 style='font-size: 1rem; padding:0px; margin:0px;'>Dépense à ce jour</h3>
					<div style='font-size: 2rem;'>{{ totalDepenseNotPlanified | abs }} €</div>
				</div>
				<div class='col-md-6' style='color:#fff; padding: 20px;margin:0px; background-color:#e81d62; color:fff;text-align:right;'>
					<h3 style='font-size: 1rem; padding:0px; margin:0px;'>Dépense à venir</h3>
					<div style='font-size: 2rem;'>{{ totalDepensePlanified | abs }} €</div>
				</div>
			</div>
		</div>
	</div>
	
	
	<!--  
	<div class='row'>
		<div class='col-md-6'>
			<div class="panel panel-success">
				<div class="panel-heading"><i class="glyphicon icon-arrow-graph-up-right"></i> Répartition Mensuelle Revenus</div>
				<div class="panel-body">
					<div class='col-md-6'>
						<canvas id="canvas-revenu" width="2" height="2"/>
					</div>
					<div class='col-md-6'>
						<ul style="list-style: none;">
							{% for totalCategorie in totauxParCategorie %}
							{% if totalCategorie['total'] > 0  %}
							<li>{{ totalCategorie['libelle_categorie'] }} <span class="badge pull-right">{{ totalCategorie['total']|abs  }} €</span></li>
							{% endif %}
							{% endfor %}
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>-->
	<div class='row'>
		<div class='col-md-9'>
			<ul class="nav nav-tabs">
				<li class="active"><a href="#accueil" data-toggle="tab">Opérations </a></li>
				<li><a href="#livres" data-toggle="tab">Opérations à venir </a></li>
			</ul>
			<div class="tab-content">
				<div class="tab-pane active" id="accueil">
					<table class="table table-striped ">
						<thead>
							<tr>
								<th></th>
								<th>
									Date
								</th>
								<th>
									Libellé
								</th>
								<th>
									Catégorie
								</th>
								<th class="text-right">
									Montant
								</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							{% for mouvementFinancier in compte.mouvementFinanciers %}
								{% if mouvementFinancier.isPlanified == false %}
									<tr>
										<td>{% if mouvementFinancier.checkBanque%}<a href="{{ path('fgs_gestion_comptes_check_mouvement_financier', {'id':mouvementFinancier.id}) }}" class='btn btn-xs text-success'><span class='glyphicon glyphicon-thumbs-up'></span></a>{% else %}<a href="{{ path('fgs_gestion_comptes_check_mouvement_financier', {'id':mouvementFinancier.id}) }}" class='btn btn-xs text-muted'><span class='glyphicon glyphicon-thumbs-down'></span></a>{% endif %}</td>
										<td>{{ mouvementFinancier.date|date("d/m/Y") }}</td>
										<td>{% if mouvementFinancier.commentaire %}<span class='glyphicon glyphicon-tag' data-toggle='tooltip' title='{{ mouvementFinancier.commentaire }}'></span> {% endif %}{{ mouvementFinancier.libelle }}</td>
										<td><p class='label {{ mouvementFinancier.montant > 0 ? 'label-success':'label-warning' }} categorie-mf'><span class=' text-center glyphicon {{ mouvementFinancier.categorieMouvementFinancier.icone }}'></span> {{ mouvementFinancier.categorieMouvementFinancier.libelle }}</p></td>
										<td class="text-right">{{ mouvementFinancier.montant|localizedcurrency('EUR') }}</td>
										<td class='text-right'>
											<a href='{{ path('fgs_gestion_comptes_modifier_mouvement_financier', {'id':mouvementFinancier.id}) }}' class='btn btn-info btn-xs'><span class='glyphicon glyphicon-pencil'></span></a> 
											<a href='{{ path('fgs_gestion_comptes_supprimer_mouvement_financier', {'id':mouvementFinancier.id}) }}' class='btn btn-danger btn-xs'><span class='glyphicon glyphicon-remove'></span></a>
										</td>
									</tr>
								{% endif %}
							{% endfor %}
						</tbody>
					</table>
				</div>
				<div class="tab-pane" id="livres">
					<table class="table table-striped ">
						<thead>
							<tr>
								<th></th>
								<th>
									Date
								</th>
								<th>
									Libellé
								</th>
								<th>
									Catégorie
								</th>
								<th class="text-right">
									Montant
								</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							{% for mouvementFinancier in compte.mouvementFinanciers %}
								{% if mouvementFinancier.isPlanified == true %}
									<tr>
										<td>{% if mouvementFinancier.checkBanque%}<a href="{{ path('fgs_gestion_comptes_check_mouvement_financier', {'id':mouvementFinancier.id}) }}" class='btn btn-xs text-success'><span class='glyphicon glyphicon-thumbs-up'></span></a>{% else %}<a href="{{ path('fgs_gestion_comptes_check_mouvement_financier', {'id':mouvementFinancier.id}) }}" class='btn btn-xs text-muted'><span class='glyphicon glyphicon-thumbs-down'></span></a>{% endif %}</td>
										<td>{{ mouvementFinancier.date|date("d/m/Y") }}</td>
										<td>{% if mouvementFinancier.commentaire %}<span class='glyphicon glyphicon-tag' data-toggle='tooltip' title='{{ mouvementFinancier.commentaire }}'></span> {% endif %}{{ mouvementFinancier.libelle }}</td>
										<td><p class='label {{ mouvementFinancier.montant > 0 ? 'label-success':'label-warning' }} categorie-mf'><span class=' text-center glyphicon {{ mouvementFinancier.categorieMouvementFinancier.icone }}'></span> {{ mouvementFinancier.categorieMouvementFinancier.libelle }}</p></td>
										<td class="text-right">{{ mouvementFinancier.montant|localizedcurrency('EUR') }}</td>
										<td class='text-right'>
											<a href='{{ path('fgs_gestion_comptes_modifier_mouvement_financier', {'id':mouvementFinancier.id}) }}' class='btn btn-info btn-xs'><span class='glyphicon glyphicon-pencil'></span></a> 
											<a href='{{ path('fgs_gestion_comptes_supprimer_mouvement_financier', {'id':mouvementFinancier.id}) }}' class='btn btn-danger btn-xs'><span class='glyphicon glyphicon-remove'></span></a>
										</td>
									</tr>
								{% endif %}
							{% endfor %}
						</tbody>
					</table>
				</div>
			</div>
			{% if compte.mouvementFinanciers is not empty %}
		</div>
		

		
		<div class='col-md-3'>
			<div class="panel panel-danger">
				<div class="panel-heading">
					Répartition Dépenses
				</div>
				<div class="panel-body">
					<div>
						<canvas id="canvas-depense" style="width: 100%; height: auto;"/>
					</div>
					<ul class='list-group' >
						{% for totalCategorie in totauxParCategorie %}
							{% if totalCategorie['total'] < 0  %}
								<li class='list-group-item' style='border:none;'>{{ totalCategorie['libelle_categorie'] }} <span class="badge pull-right">{{ totalCategorie['total']|abs  }} €</span></li>
							{% endif %}
						{% endfor %}
					</ul>
				</div>
			</div>
		</div>
	</div>

	{% else %}
		<p class='well well-sm' style='background-color:#f9f9f9;'>Aucune transaction n'a encore été réalisé sur ce compte ce mois ci.<p>
	{% endif %}

{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="{{ asset('bundles/fgsgestioncomptes/css/iconset/daily-life.css') }}">
	<style>
	
	.categorie-mf {
		font-size:90%; font-weight: normal;
	}
	.info
	{
		color:			#fff; 
		padding: 		0px;
		margin:			0px; 
		color:			#000;
		margin-bottom:	21px !important;
	}
	.info:before
	{
		font-family: 	"daily-life" !important;
		content:		"'";
		position: 		absolute;
		position:		absolute; 
		top:			50%; 
		left:			50%; 
		height:			40px; 
		width:			40px;
		line-height:	40px;
		vertical-align:	middle;
		font-size:		20px;
		text-align:		center;  
		border-radius:	50%;
		background-color:#fff;
		border:			1px solid #8ac249;
		z-index:		2;
		margin:			-30px 0px 0px -20px;
		
	}
	.info:after
	{
		content:	'';
		box-sizing: border-box;
		clear: 		both;
		display: 	table;
	}
					<div style='color:#8ac249;'>
					<i class="glyphicon icon-arrow-graph-up-right" ></i>
				</div>
	
	
	</style>
{% endblock %}


{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('bundles/fgsgestioncomptes/js/Chart.js') }}"></script>
	<script>
	
	$(function () {
	  $('[data-toggle="tooltip"]').tooltip();
	})
	
	var dataCanvasDepense = [
		{% for totalCategorie in totauxParCategorie %}
			{% if totalCategorie['total'] < 0  %}
			{
				value: {{ totalCategorie['total']|abs  }},
				color:"#F7464A",
				highlight: "#FF5A5E",
				label: "{{ totalCategorie['libelle_categorie'] }}"
			}
			{% if loop.last == false %},{% endif %}
			{% endif %}
		{% endfor %}
	];

	var confCanvas = {responsive : true};

	window.onload = function(){
		var ctx = document.getElementById("canvas-depense").getContext("2d");
		window.myDoughnut = new Chart(ctx).Doughnut(dataCanvasDepense, confCanvas);

	};

	
	</script>
{% endblock %}